<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RobCo Industries Termlink</title>
    <style>
        :root {
            --terminal-green: #14fdce; /* Fallout NV/3 style green/amber */
            --terminal-dim: #0c8a70;
            --terminal-bg: #0a0a0a;
            --terminal-alert: #ff4444;
        }

        body {
            background-color: var(--terminal-bg);
            color: var(--terminal-green);
            font-family: "Courier New", Courier, monospace;
            display: flex;
            justify-content: center;
            padding: 20px;
            margin: 0;
            height: 100vh;
            box-sizing: border-box;
            text-shadow: 0 0 2px var(--terminal-dim);
        }

        .container {
            width: 100%;
            max-width: 600px;
            border: 2px solid var(--terminal-green);
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 15px var(--terminal-dim);
            position: relative;
        }

        h1 {
            text-align: center;
            border-bottom: 1px dashed var(--terminal-green);
            padding-bottom: 10px;
            margin-top: 0;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }

        input {
            background: #000;
            border: 1px solid var(--terminal-green);
            color: var(--terminal-green);
            font-family: inherit;
            font-size: 1.2rem;
            padding: 10px;
            outline: none;
            text-transform: uppercase;
        }

        input:focus {
            box-shadow: 0 0 5px var(--terminal-green);
        }

        #guessInput {
            flex-grow: 2;
        }

        #likenessInput {
            width: 60px;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        button {
            flex-grow: 1;
            background: var(--terminal-green);
            color: #000;
            border: none;
            padding: 10px;
            font-family: inherit;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            font-size: 1rem;
        }

        button:hover {
            background: #fff;
        }

        button#clearBtn {
            background: transparent;
            border: 1px solid var(--terminal-green);
            color: var(--terminal-green);
        }

        button#clearBtn:hover {
            background: var(--terminal-alert);
            color: #fff;
            border-color: var(--terminal-alert);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            border: 1px solid var(--terminal-dim);
            padding: 10px;
            text-align: left;
        }

        th {
            background-color: #0f1c18;
        }

        .status-col {
            width: 100px;
            text-align: center;
            font-weight: bold;
        }

        .status-YES { color: var(--terminal-green); }
        .status-NO { color: var(--terminal-alert); }
        .status-ERR { color: orange; }

        /* Scanline effect */
        .scanline {
            width: 100%;
            height: 100px;
            z-index: 10;
            background: linear-gradient(0deg, rgba(0,0,0,0) 0%, rgba(20, 253, 206, 0.1) 50%, rgba(0,0,0,0) 100%);
            opacity: 0.1;
            position: absolute;
            bottom: 100%;
            pointer-events: none;
            animation: scanline 10s linear infinite;
        }

        @keyframes scanline {
            0% { bottom: 100%; }
            100% { bottom: -100%; }
        }

        .helper-text {
            font-size: 0.8rem;
            color: var(--terminal-dim);
            margin-bottom: 5px;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="scanline"></div>
    <h1>Fallout Decrypter</h1>

    <div class="helper-text">ENTER PASSWORD & MATCH COUNT</div>
    <div class="input-group">
        <input type="text" id="guessInput" placeholder="GUESS" maxlength="6" autocomplete="off">
        <input type="number" id="likenessInput" placeholder="#" min="0" max="6">
    </div>

    <div class="controls">
        <button id="addBtn">Add to History</button>
        <button id="clearBtn">Clear / Reset</button>
    </div>

    <table>
        <thead>
            <tr>
                <th>GUESS</th>
                <th>MATCHES</th>
                <th class="status-col">STATUS</th>
            </tr>
        </thead>
        <tbody id="historyBody">
            </tbody>
    </table>
</div>

<script>
    // State management
    const MAX_HISTORY = 4;
    let history = []; // Array of { word: string, likeness: number }

    // DOM Elements
    const guessInput = document.getElementById('guessInput');
    const likenessInput = document.getElementById('likenessInput');
    const addBtn = document.getElementById('addBtn');
    const clearBtn = document.getElementById('clearBtn');
    const historyBody = document.getElementById('historyBody');

    // --- Core Logic (Ported from C#) ---

    function getCompatibility(newGuess, oldGuess, oldLikeness) {
        newGuess = newGuess.toUpperCase();
        oldGuess = oldGuess.toUpperCase();

        // If new guess is longer than old guess, it's an error based on prompt logic
        if (newGuess.length > oldGuess.length) {
            return "ERR";
        }

        const isPartialCheck = newGuess.length !== oldGuess.length;
        let match = 0;

        // Count character matches in same positions
        for (let i = 0; i < newGuess.length; i++) {
            if (newGuess[i] === oldGuess[i]) {
                match++;
            }
        }

        if (isPartialCheck) {
            // If we are typing and already have more matches than allowed by history
            return (match > oldLikeness) ? "NO" : "";
        } else {
            // Full length check
            return (match === parseInt(oldLikeness)) ? "YES" : "NO";
        }
    }

    // --- UI Updates ---

    function updateStatuses() {
        const currentInput = guessInput.value.toUpperCase();
        
        // Get all rows currently in the table
        const rows = historyBody.querySelectorAll('tr');

        rows.forEach((row, index) => {
            const statusCell = row.cells[2];
            
            // Retrieve stored data from the row
            const oldGuess = row.getAttribute('data-word');
            const oldLikeness = parseInt(row.getAttribute('data-likeness'));

            // Calculate status
            let status = getCompatibility(currentInput, oldGuess, oldLikeness);
            
            // Update Text
            statusCell.textContent = status;
            
            // Update Color Class
            statusCell.className = 'status-col'; // reset
            if (status === 'YES') statusCell.classList.add('status-YES');
            if (status === 'NO') statusCell.classList.add('status-NO');
            if (status === 'ERR') statusCell.classList.add('status-ERR');
        });
    }

    function renderRow(guess, likeness) {
        const tr = document.createElement('tr');
        
        // Store data in attributes for easy access during real-time checking
        tr.setAttribute('data-word', guess);
        tr.setAttribute('data-likeness', likeness);

        // Column 1: Guess
        const tdWord = document.createElement('td');
        tdWord.textContent = guess;
        tr.appendChild(tdWord);

        // Column 2: Count
        const tdLike = document.createElement('td');
        tdLike.textContent = likeness;
        tr.appendChild(tdLike);

        // Column 3: Status (starts empty)
        const tdStatus = document.createElement('td');
        tdStatus.className = 'status-col';
        tr.appendChild(tdStatus);

        historyBody.appendChild(tr);
    }

    // --- Event Handlers ---

    // 1. Real-time typing check
    guessInput.addEventListener('keyup', () => {
        updateStatuses();
    });
    
    // Also trigger on input (for pasting etc)
    guessInput.addEventListener('input', () => {
        updateStatuses();
    });

    // 2. Add Button Logic
    addBtn.addEventListener('click', () => {
        const word = guessInput.value.toUpperCase().trim();
        const likeness = parseInt(likenessInput.value);

        // Basic Validation
        if (word.length < 4 || word.length > 6) {
            alert("Password must be between 4 and 6 characters.");
            return;
        }
        if (isNaN(likeness) || likeness < 0 || likeness > 6) {
            alert("Likeness match must be a number between 0 and 6.");
            return;
        }
        if (history.length >= MAX_HISTORY) {
            alert("History full. Please Clear/Reset.");
            return;
        }

        // Add to state
        history.push({ word, likeness });

        // Add to DOM
        renderRow(word, likeness);

        // Clear inputs and reset focus
        guessInput.value = '';
        likenessInput.value = '';
        guessInput.focus();

        // Clear statuses in the table (since input is now empty)
        updateStatuses();
    });

    // 3. Clear Button Logic
    clearBtn.addEventListener('click', () => {
        history = [];
        historyBody.innerHTML = '';
        guessInput.value = '';
        likenessInput.value = '';
        guessInput.focus();
    });

</script>

</body>
</html>